# 头像上传本地存储说明

## 修改说明

**已修改头像上传功能，不再依赖 MinIO/OSS 服务！**

现在头像上传功能使用**本地文件存储**，无需配置 MinIO 或其他对象存储服务。

## 修改内容

### 1. 头像上传功能
- **文件位置**：`backend/ruoyi-modules/ruoyi-system/src/main/java/com/ruoyi/system/controller/system/SysProfileController.java`
- **存储位置**：项目根目录下的 `upload/avatar/` 文件夹
- **访问路径**：`/upload/avatar/文件名`

### 2. 静态资源访问配置
- **文件位置**：`backend/ruoyi-common/ruoyi-common-web/src/main/java/com/ruoyi/common/web/config/ResourcesConfig.java`
- **功能**：配置了 `/upload/**` 路径映射，可以直接通过URL访问上传的文件

## 使用说明

### 上传头像后：
1. 文件保存在：`项目根目录/upload/avatar/用户ID_时间戳.扩展名`
2. 访问URL格式：`http://localhost:8080/upload/avatar/用户ID_时间戳.扩展名`
3. 前端会自动显示头像

### 文件命名规则
- 格式：`{用户ID}_{时间戳}.{扩展名}`
- 示例：`1_1701234567890.png`

## 项目中 OSS 的使用情况

### ✅ 已改为本地存储
- **头像上传**：已改为本地文件存储

### ⚠️ 仍使用 OSS 的功能
以下功能仍使用 OSS（如果需要使用，需要配置 MinIO 或其他 OSS 服务）：
1. **文件上传组件** (`FileUpload`)
   - 位置：`frontend/src/components/FileUpload/index.vue`
   - 用途：通用文件上传
   - 接口：`/system/oss/upload`

2. **图片上传组件** (`ImageUpload`)
   - 位置：`frontend/src/components/ImageUpload/index.vue`
   - 用途：图片上传
   - 接口：`/system/oss/upload`

3. **对象存储管理**
   - 位置：系统管理 → 对象存储
   - 用途：管理上传的文件

## 如果不想使用 OSS

如果您的项目中不需要文件上传功能，可以：

1. **忽略 OSS 配置错误**
   - 系统会在 OSS 连接失败时显示错误，但不影响头像上传功能
   - 头像上传已独立，不受影响

2. **禁用 OSS 相关功能**
   - 如果确定不需要文件上传，可以注释掉相关的前端组件
   - 或者配置一个假的 OSS 配置（虽然会报错，但不影响使用）

3. **完全移除 OSS 依赖**（可选）
   - 如果确定不需要，可以移除 OSS 相关的代码
   - 但这需要更多修改，不推荐

## 注意事项

### 1. 文件存储位置
- 默认存储在项目根目录的 `upload/avatar/` 文件夹
- 确保应用有该目录的读写权限

### 2. 生产环境部署
- 建议将 `upload` 目录放在项目外部，避免重启时丢失
- 可以通过环境变量或配置文件指定路径

### 3. 文件清理
- 系统不会自动清理旧头像文件
- 建议定期清理 `upload/avatar/` 目录中的旧文件

### 4. 多服务器部署
- 如果使用多台服务器，需要共享 `upload` 目录
- 或使用 NFS、共享存储等方式

## 测试

1. 启动后端服务
2. 登录系统
3. 进入"个人信息"页面
4. 点击头像，上传新头像
5. 应该可以正常上传和显示，无需 MinIO

## 常见问题

### Q: 上传后头像不显示？
**A:** 检查：
1. `upload/avatar/` 目录是否存在
2. 文件是否成功保存
3. 静态资源映射是否正确配置
4. 浏览器控制台是否有错误

### Q: 可以修改存储路径吗？
**A:** 可以，修改 `SysProfileController.uploadAvatarToLocal()` 方法中的 `uploadPath` 变量

### Q: 其他文件上传功能还能用吗？
**A:** 其他文件上传功能（FileUpload、ImageUpload）仍需要 OSS 配置。如果不需要这些功能，可以忽略 OSS 错误。

---

**提示**：现在您可以正常使用头像上传功能，无需配置 MinIO！🎉

