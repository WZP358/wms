# WMS测试数据生成脚本使用说明

## 文件说明

- `wms_test_data.sql` - WMS系统测试数据生成脚本

## 功能说明

此脚本为WMS（仓库管理系统）的所有业务表生成足够的测试数据，**不包括若依框架自带的sys_开头的系统表**。

## 生成的数据表

### 基础数据表
1. **wms_warehouse** (仓库表) - 补充7个新仓库
2. **wms_area** (库区表) - 为每个仓库生成3-5个库区
3. **wms_merchant** (往来单位表) - 补充10个往来单位
4. **wms_item_brand** (商品品牌表) - 补充10个品牌
5. **wms_item_category** (物料类型表) - 补充9个分类

### 物料相关表
6. **wms_item** (物料表) - 补充20个物料
7. **wms_item_sku** (SKU信息表) - 为每个物料生成2-3个SKU，共约50个SKU

### 业务单据表
8. **wms_receipt_order** (入库单表) - 生成30条入库单
9. **wms_receipt_order_detail** (入库单详情表) - 为每个入库单生成2-5条详情，共约100条
10. **wms_shipment_order** (出库单表) - 生成30条出库单
11. **wms_shipment_order_detail** (出库单详情表) - 为每个出库单生成2-4条详情，共约90条
12. **wms_movement_order** (移库单表) - 生成20条移库单
13. **wms_movement_order_detail** (移库单详情表) - 为每个移库单生成2-4条详情，共约60条
14. **wms_check_order** (盘点单表) - 生成20条盘点单
15. **wms_check_order_detail** (盘点单详情表) - 为每个盘点单生成3-6条详情，共约100条

### 库存相关表
16. **wms_inventory** (库存表) - 为不同SKU在不同仓库/库区生成库存记录，约200条
17. **wms_inventory_detail** (库存详情表) - 基于入库单生成库存详情，约100条
18. **wms_inventory_history** (库存历史表) - 生成入库、出库、移库历史记录，约120条

### 其他表
19. **wms_serial_number** (SN码表) - 为需要SN码的商品生成序列号，约200条

## 使用方法

### 方法一：使用MySQL命令行

```bash
# 1. 登录MySQL
mysql -u root -p

# 2. 选择数据库
USE wms;

# 3. 执行脚本
source backend/script/sql/wms_test_data.sql;
```

### 方法二：使用MySQL客户端工具

1. 打开MySQL客户端工具（如Navicat、DBeaver、MySQL Workbench等）
2. 连接到数据库
3. 选择 `wms` 数据库
4. 打开 `backend/script/sql/wms_test_data.sql` 文件
5. 执行整个脚本

### 方法三：使用命令行直接执行

```bash
mysql -u root -p wms < backend/script/sql/wms_test_data.sql
```

## 注意事项

1. **执行前备份**：建议在执行脚本前备份数据库，以防数据冲突
2. **数据冲突**：脚本使用 `NOT EXISTS` 检查避免重复数据，但如果已有大量数据，可能需要先清理
3. **外键约束**：脚本生成的数据遵循表之间的外键关系
4. **随机数据**：部分数据使用 `RAND()` 函数生成，每次执行结果可能略有不同
5. **时间数据**：单据的创建时间会分布在过去30天内，模拟真实业务场景

## 数据特点

- **真实性**：数据模拟真实业务场景，包括合理的价格、数量、日期等
- **关联性**：数据之间保持正确的关联关系（如入库单与入库单详情、库存与库存详情等）
- **多样性**：涵盖不同类型的商品、客户、供应商等
- **完整性**：覆盖WMS系统的主要业务流程（入库、出库、移库、盘点等）

## 数据量统计

执行完成后，预计生成：
- 仓库：10个（原有3个 + 新增7个）
- 库区：约60个
- 往来单位：13个（原有3个 + 新增10个）
- 品牌：15个（原有5个 + 新增10个）
- 物料分类：19个（原有10个 + 新增9个）
- 物料：30个（原有10个 + 新增20个）
- SKU：约68个（原有18个 + 新增50个）
- 入库单：32个（原有2个 + 新增30个）
- 入库单详情：约105个（原有5个 + 新增100个）
- 出库单：30个
- 出库单详情：约90个
- 移库单：21个（原有1个 + 新增20个）
- 移库单详情：约64个（原有4个 + 新增60个）
- 盘点单：20个
- 盘点单详情：约100个
- 库存记录：约208个（原有8个 + 新增200个）
- 库存详情：约105个（原有5个 + 新增100个）
- 库存历史：约132个（原有12个 + 新增120个）
- SN码：约200个

## 故障排除

### 问题1：外键约束错误
**原因**：某些表的外键引用的数据不存在  
**解决**：确保先执行基础数据表的插入（仓库、库区、往来单位等）

### 问题2：唯一约束冲突
**原因**：某些字段有唯一约束（如仓库编号、往来单位编号等）  
**解决**：检查现有数据，修改脚本中的编号或删除冲突数据

### 问题3：子查询返回多行
**原因**：某些子查询可能返回多行数据  
**解决**：检查子查询，确保使用 `LIMIT 1` 或添加更精确的WHERE条件

## 后续操作建议

1. **验证数据**：执行完成后，建议检查各表的数据量是否符合预期
2. **测试功能**：使用生成的数据测试WMS系统的各项功能
3. **性能测试**：使用大量数据进行性能测试
4. **数据清理**：测试完成后，如需清理测试数据，可以使用DELETE语句（注意外键约束）

## 联系支持

如有问题，请检查：
1. MySQL版本是否支持使用的SQL语法
2. 数据库字符集是否为utf8mb4
3. 是否有足够的权限执行INSERT操作

