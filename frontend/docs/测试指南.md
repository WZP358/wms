# 仓库地图系统测试指南

## 测试环境准备

### 前置条件
- ✅ 前端服务已启动
- ✅ 浏览器支持ES6+（推荐Chrome/Edge最新版）
- ✅ 浏览器已启用LocalStorage

### 测试浏览器
- Chrome 90+
- Edge 90+
- Firefox 88+
- Safari 14+

## 功能测试清单

### 1. 地图生成测试

#### 测试用例1.1：默认地图生成
**步骤**：
1. 访问仓库地图页面
2. 观察地图是否正确显示

**期望结果**：
- ✅ 地图显示10行15列的格子
- ✅ 第一行只有一个绿色的"大门"格子
- ✅ 其他格子为灰色空格子
- ✅ 格子之间有间隙

#### 测试用例1.2：自定义地图大小
**步骤**：
1. 修改地图宽度为20列
2. 修改地图高度为15行
3. 点击"重新生成地图"

**期望结果**：
- ✅ 地图重新生成为15行20列
- ✅ 第一行仍然只有一个大门
- ✅ 原有的库区设置被清除

#### 测试用例1.3：格子大小调整
**步骤**：
1. 修改格子大小为30px
2. 修改格子间隙为10px
3. 观察地图变化

**期望结果**：
- ✅ 格子变小，间隙变大
- ✅ 地图布局重新计算居中
- ✅ 不需要点击"重新生成地图"就能看到变化

### 2. 库区管理测试

#### 测试用例2.1：添加库区
**步骤**：
1. 点击"添加库区"按钮
2. 观察新库区是否出现

**期望结果**：
- ✅ 库区列表中新增一个库区
- ✅ 库区有默认名称（如"库区5"）
- ✅ 库区有独特的颜色
- ✅ 可以编辑库区名称

#### 测试用例2.2：删除库区
**步骤**：
1. 点击某个库区的删除按钮
2. 观察库区是否被删除

**期望结果**：
- ✅ 库区从列表中移除
- ✅ 地图上该库区的格子变为空格子
- ✅ "大门"库区不能被删除

#### 测试用例2.3：重命名库区
**步骤**：
1. 在库区名称输入框中修改名称
2. 失去焦点或按回车

**期望结果**：
- ✅ 库区名称成功修改
- ✅ 鼠标悬停在该库区格子上显示新名称

### 3. 格子设置测试

#### 测试用例3.1：右键设置库区
**步骤**：
1. 右键点击任意空格子
2. 在菜单中选择一个库区
3. 观察格子变化

**期望结果**：
- ✅ 弹出库区选择菜单
- ✅ 菜单显示所有可用库区
- ✅ 格子变为选中库区的颜色
- ✅ 大门格子右键不弹出菜单

#### 测试用例3.2：清除格子设置
**步骤**：
1. 右键点击已设置库区的格子
2. 选择"清除"选项

**期望结果**：
- ✅ 格子变回灰色空格子
- ✅ 库区信息被清除

#### 测试用例3.3：覆盖格子设置
**步骤**：
1. 右键点击已设置为A区的格子
2. 选择B区

**期望结果**：
- ✅ 格子从A区颜色变为B区颜色
- ✅ 库区归属更新

### 4. 信息提示测试

#### 测试用例4.1：鼠标悬停显示信息
**步骤**：
1. 将鼠标移动到大门格子上
2. 将鼠标移动到库区格子上
3. 将鼠标移动到空格子上

**期望结果**：
- ✅ 大门：显示"仓库大门"和位置
- ✅ 库区：显示库区名称、位置、颜色
- ✅ 空格子：显示位置和"右键设置库区"提示
- ✅ 鼠标移开后提示消失

#### 测试用例4.2：格子悬停高亮
**步骤**：
1. 将鼠标移动到格子上
2. 观察视觉效果

**期望结果**：
- ✅ 格子放大（scale 1.05）
- ✅ 出现阴影效果
- ✅ 鼠标移开后恢复

### 5. 路径规划测试

#### 测试用例5.1：简单路径规划（3个点）
**步骤**：
1. 设置3个不同的库区（A、B、C）
2. 每个库区至少设置2个格子
3. 在"路径规划"中选择这3个库区
4. 点击"计算最优路径"

**期望结果**：
- ✅ 计算在3秒内完成
- ✅ 地图上显示蓝色虚线路径
- ✅ 显示访问顺序（0、1、2、3）
- ✅ 显示总距离
- ✅ 起点和终点都是大门（绿色和红色标记）

#### 测试用例5.2：复杂路径规划（5+个点）
**步骤**：
1. 设置5个以上的库区
2. 选择所有库区
3. 点击"计算最优路径"

**期望结果**：
- ✅ 计算在10秒内完成
- ✅ 路径正确连接所有库区
- ✅ 路径是闭环（从大门出发，回到大门）
- ✅ 距离是合理的（不会明显绕远）

#### 测试用例5.3：未选择目标库区
**步骤**：
1. 不选择任何库区
2. 点击"计算最优路径"

**期望结果**：
- ✅ 显示警告提示："请至少选择一个目标库区"
- ✅ 不进行计算

#### 测试用例5.4：目标库区无格子
**步骤**：
1. 添加一个新库区但不设置格子
2. 选择该库区
3. 点击"计算最优路径"

**期望结果**：
- ✅ 显示错误提示："所选库区没有格子"
- ✅ 不进行计算

#### 测试用例5.5：算法参数调整
**步骤**：
1. 修改迭代次数为5000
2. 修改初始温度为500
3. 修改冷却速率为0.990
4. 计算路径

**期望结果**：
- ✅ 使用新参数进行计算
- ✅ 计算速度更快（因为迭代次数少）
- ✅ 结果可能略有不同

### 6. 路径可视化测试

#### 测试用例6.1：路径显示
**步骤**：
1. 计算一条路径
2. 观察路径显示

**期望结果**：
- ✅ 路径线条清晰可见（蓝色虚线）
- ✅ 路径点用圆圈标记
- ✅ 每个点显示顺序数字
- ✅ 起点为绿色，终点为红色，中间点为蓝色

#### 测试用例6.2：清除路径
**步骤**：
1. 计算一条路径
2. 点击"清除路径"按钮

**期望结果**：
- ✅ 路径线条消失
- ✅ 路径标记消失
- ✅ 总距离信息消失
- ✅ 选中的目标库区被清空

### 7. 动画播放测试

#### 测试用例7.1：基本动画播放
**步骤**：
1. 计算一条路径
2. 点击"播放动画"按钮

**期望结果**：
- ✅ 黄色动态标记从起点开始移动
- ✅ 标记沿着路径线条移动
- ✅ 经过每个访问点
- ✅ 到达终点后自动停止
- ✅ 显示"动画播放完成"提示

#### 测试用例7.2：调整播放速度
**步骤**：
1. 将速度调到1（慢速）
2. 播放动画，观察速度
3. 重置，将速度调到10（快速）
4. 再次播放

**期望结果**：
- ✅ 速度1时移动缓慢
- ✅ 速度10时移动快速
- ✅ 速度平滑变化

#### 测试用例7.3：停止动画
**步骤**：
1. 播放动画
2. 在动画进行中点击"停止"按钮

**期望结果**：
- ✅ 动画立即停止
- ✅ 标记停在当前位置
- ✅ "播放动画"按钮变为可用

#### 测试用例7.4：重置动画
**步骤**：
1. 播放动画到一半
2. 点击"重置"按钮

**期望结果**：
- ✅ 动画停止
- ✅ 标记消失
- ✅ 可以重新播放

#### 测试用例7.5：动画期间格子高亮
**步骤**：
1. 播放动画
2. 观察标记经过的格子

**期望结果**：
- ✅ 当前访问的格子有脉冲动画
- ✅ 格子轻微放大缩小

### 8. 本地存储测试

#### 测试用例8.1：自动保存
**步骤**：
1. 设置几个库区
2. 设置地图配置
3. 刷新页面

**期望结果**：
- ✅ 刷新后库区设置保留
- ✅ 刷新后地图配置保留
- ✅ 显示"已加载上次保存的配置"提示

#### 测试用例8.2：手动保存
**步骤**：
1. 修改配置
2. 点击"保存配置"按钮

**期望结果**：
- ✅ 显示"配置已保存到本地"提示
- ✅ 刷新页面后配置保留

#### 测试用例8.3：加载配置
**步骤**：
1. 修改配置但不保存
2. 点击"加载配置"按钮

**期望结果**：
- ✅ 恢复到上次保存的配置
- ✅ 显示"已加载上次保存的配置"提示

#### 测试用例8.4：清空所有
**步骤**：
1. 设置完整的地图
2. 点击"清空设置"按钮

**期望结果**：
- ✅ 所有格子库区设置被清除
- ✅ 路径被清除
- ✅ 选中的目标库区被清空
- ✅ 显示"地图已清空"提示

### 9. 边界情况测试

#### 测试用例9.1：最小地图（3x3）
**步骤**：
1. 设置地图为3行3列
2. 重新生成地图
3. 设置库区并计算路径

**期望结果**：
- ✅ 地图正常显示
- ✅ 路径正常计算

#### 测试用例9.2：最大地图（30x30）
**步骤**：
1. 设置地图为30行30列
2. 重新生成地图
3. 观察性能

**期望结果**：
- ✅ 地图能正常生成（可能需要几秒）
- ✅ 滚动流畅
- ✅ 右键菜单响应正常

#### 测试用例9.3：单个目标库区
**步骤**：
1. 只选择一个库区
2. 计算路径

**期望结果**：
- ✅ 路径正常：大门 → 库区 → 大门
- ✅ 显示3个点（起点、目标、终点）

#### 测试用例9.4：相同位置的库区
**步骤**：
1. 将同一个格子先设为A区，再设为B区
2. 选择B区计算路径

**期望结果**：
- ✅ 格子显示为B区颜色
- ✅ 路径正确计算到B区

### 10. 性能测试

#### 测试用例10.1：路径计算时间
**测试配置**：
- 地图：10x15
- 目标：5个库区

**期望结果**：
- ✅ 计算时间 < 3秒
- ✅ 页面不卡顿

#### 测试用例10.2：动画流畅度
**测试配置**：
- 路径：访问10个点
- 速度：5（中速）

**期望结果**：
- ✅ 帧率 > 30fps
- ✅ 移动平滑无卡顿

#### 测试用例10.3：大量格子设置
**测试配置**：
- 地图：20x20
- 设置100个格子

**期望结果**：
- ✅ 右键响应速度 < 100ms
- ✅ 悬停提示延迟 < 50ms

## 兼容性测试

### 浏览器兼容性
- [ ] Chrome 90+
- [ ] Edge 90+
- [ ] Firefox 88+
- [ ] Safari 14+

### 屏幕分辨率
- [ ] 1920x1080
- [ ] 1366x768
- [ ] 2560x1440
- [ ] 3840x2160 (4K)

### 缩放级别
- [ ] 100%
- [ ] 125%
- [ ] 150%

## 常见问题调试

### 问题1：路径不显示
**可能原因**：
- 格子未设置库区
- 目标库区未选择
- SVG层级问题

**调试方法**：
1. 打开浏览器控制台
2. 检查是否有错误信息
3. 检查pathResult是否有值
4. 检查pathLines是否有数据

### 问题2：动画不流畅
**可能原因**：
- 电脑性能不足
- 浏览器占用资源过多
- 地图过大

**解决方法**：
1. 关闭其他标签页
2. 减小地图大小
3. 降低动画速度

### 问题3：配置丢失
**可能原因**：
- LocalStorage被清除
- 浏览器隐私模式
- 域名变化

**解决方法**：
1. 检查localStorage
2. 使用正常模式浏览器
3. 手动保存配置

## 自动化测试建议

### 单元测试
```javascript
// 测试距离计算
test('distance calculation', () => {
  const p1 = { x: 0, y: 0 };
  const p2 = { x: 3, y: 4 };
  expect(distance(p1, p2)).toBe(5);
});

// 测试路径总距离
test('total distance', () => {
  const path = [
    { x: 0, y: 0 },
    { x: 1, y: 0 },
    { x: 1, y: 1 }
  ];
  expect(calculateTotalDistance(path)).toBe(2);
});
```

### E2E测试（Cypress）
```javascript
// 测试地图生成
describe('Map Generation', () => {
  it('should generate default map', () => {
    cy.visit('/wms/map');
    cy.get('.grid-cell').should('have.length.gt', 0);
    cy.get('.is-door').should('have.length', 1);
  });
});

// 测试路径规划
describe('Path Planning', () => {
  it('should calculate path', () => {
    cy.visit('/wms/map');
    // 设置库区...
    cy.get('[data-test="calculate-btn"]').click();
    cy.get('.path-layer line').should('exist');
  });
});
```

## 测试报告模板

### 测试环境
- 浏览器：Chrome 120
- 操作系统：Windows 11
- 屏幕分辨率：1920x1080
- 测试日期：2025-11-24

### 测试结果
| 测试项 | 通过 | 失败 | 备注 |
|-------|-----|-----|------|
| 地图生成 | ✅ | | |
| 库区管理 | ✅ | | |
| 格子设置 | ✅ | | |
| 信息提示 | ✅ | | |
| 路径规划 | ✅ | | |
| 路径可视化 | ✅ | | |
| 动画播放 | ✅ | | |
| 本地存储 | ✅ | | |
| 边界情况 | ✅ | | |
| 性能测试 | ✅ | | |

### 发现的问题
1. 无

### 建议
1. 考虑添加导出功能
2. 可以增加路径对比功能
3. 支持撤销/重做操作

---

**测试人员签名**：___________  
**测试日期**：___________

